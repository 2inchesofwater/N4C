// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
// @license: Mad4Media Javascipt License - copyright Mad4Media - Fahrettin Kutyol - All rights reserved    ++
// (re-) publishing or forking for any purpose of commercial or non-commercial use is not allowed.		   ++
// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

var OptManager={wrapNode:null,dragging:false,currentItem:undefined,dummy:null,mouse:null,dropFocus:undefined,space:8,place:"before",stopBubble:0,factoryNode:null,useValues:0,onMouseDown:function(e){if(!OptManager.stopBubble){OptManager.dragging=1;OptManager.currentItem=this;OptManager.addDummy(this);var _1=_ViewportOffset(this,true);document.body.appendChild(this);var _2=OptManager.getPosition();dojo.style(this,{position:"absolute",opacity:0.5,left:_2.left,top:_2.top});}},getPosition:function(){return {left:(OptManager.mouse.x+OptManager.space)+"px",top:(OptManager.mouse.y+OptManager.space)+"px"};},onMouseUp:function(e){if(this.dragging){this.dragging=0;var db=_ViewportOffset(this.dummy,false);var _3=this.currentItem;dojo.animateProperty({node:_3,properties:{top:db.t,left:db.l,opacity:1},onEnd:function(){OptManager.onEnd();},duration:300}).play();}},onEnd:function(){dojo.style(this.currentItem,{position:"relative",opacity:1,top:"auto",left:"auto"});dojo.place(this.currentItem,this.dummy,"before");this.dropFocus=null;this.removeDummy();this.currentItem=null;},onMouseMove:function(e){if(this.dragging){var _4=OptManager.getPosition();dojo.style(this.currentItem,{left:_4.left,top:_4.top});}},onMouseOver:function(e){if(OptManager.currentItem==this){return false;}if(OptManager.dragging&&!this.placed){this.placed=1;OptManager.dropFocus=this;var _5=_ViewportOffset(this,true);var _6=(_5.t>OptManager.dummy.bounds.t)?"after":"before";dojo.place(OptManager.dummy,this,_6);OptManager.dummy.bounds=_ViewportOffset(OptManager.dummy,true);}},onMouseOut:function(e){if(OptManager.currentItem==this){return false;}if(OptManager.dragging){this.placed=0;OptManager.dropFocus=null;}},removeDummy:function(){this.dummy.parentNode.removeChild(this.dummy);this.dummy=null;},addDummy:function(_7){var _8=document.createElement("DIV");_8.className="optionsWrapDummy";dojo.place(_8,_7,"before");_8.bounds=_ViewportOffset(_8,true);this.dummy=_8;},remove:function(_9){var _a=0,_b=1;while(_b){_9=_9.parentNode;_a=(_9.className=="optionsWrap unselectable");_b=!(_9.className=="optionsWrap unselectable"||_9==document.body);}if(_a){_fx.fadeOpacity(_9,300,1,0,dojo.hitch(this,function(){_fx.animToHeight(_9,300,0,dojo.hitch(this,function(){_9.parentNode.removeChild(_9);}));}));}},copy:function(_c){var _d=0;while(!_d){_c=_c.parentNode;_d=(_c.className=="optionsWrap unselectable");}var _e=dojo.clone(_c);_e.placed=0;dojo.connect(_e,"mousedown",OptManager.onMouseDown);dojo.connect(_e,"mouseover",OptManager.onMouseOver);dojo.connect(_e,"mouseout",OptManager.onMouseOut);dojo.connect(_e,"selectstart",function(){if(this.className=="optionInput"){return true;}else{return false;}});_e.unselectable="on";_e.style.MozUserSelect="none";var _f=document.createElement("DIV");_f.className="optionsWrapDummy";_f.style.height="0px";dojo.place(_f,_c,"after");_fx.animToHeight(_f,300,55,dojo.hitch(this,function(){dojo.place(_e,_f,"before");dojo.style(_e,{opacity:0});dojo.anim(_e,{opacity:1}).play();_f.parentNode.removeChild(_f);}));},setBubble:function(_10){if(!this.dragging){this.stopBubble=_10;}},add:function(){var _11=this.useValues?"":"disabled";var _12=this.useValues?"":"style=\"color: #888; \"";var _13=document.createElement("DIV");_13.className="optionsWrap unselectable";var _14=this.factoryNode.innerHTML;_13.innerHTML=(_14.replace("{textdisabled}",_12).replace("{inputdisabled}",_11));_13.placed=0;dojo.connect(_13,"mousedown",OptManager.onMouseDown);dojo.connect(_13,"mouseover",OptManager.onMouseOver);dojo.connect(_13,"mouseout",OptManager.onMouseOut);dojo.connect(_13,"selectstart",function(){return false;});_13.unselectable="on";this.wrapNode.appendChild(_13);},toggleUseValues:function(){this.useValues=this.useValues?0:1;var _15=this.useValues?false:true;var _16=this.useValues?"inherit":"#888";var _17=dojo.query(".optionValuesInput");_17.forEach(function(_18){_18.disabled=_15;});var _19=dojo.query(".optionValuesInputText");_19.forEach(function(_1a){_1a.style.color=_16;});},parse:function(){var _1b=dojo.query(".optionsWrap",this.wrapNode);_1b.forEach(function(_1c){_1c.placed=0;dojo.connect(_1c,"mousedown",OptManager.onMouseDown);dojo.connect(_1c,"mouseover",OptManager.onMouseOver);dojo.connect(_1c,"mouseout",OptManager.onMouseOut);dojo.connect(_1c,"selectstart",function(){return false;});_1c.unselectable="on";});}};dojo.addOnLoad(function(){OptManager.wrapNode=dojo.byId("optionsRootNode");OptManager.factoryNode=dojo.byId("optionsFactoryNode");dojo.connect(document,"mousemove",function(e){OptManager.mouse=detectMousePosition(e);OptManager.onMouseMove();});dojo.connect(document,"mouseup",function(e){OptManager.onMouseUp();});OptManager.parse();});